<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.525">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Advanced Statistics - Model Selection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Advanced Statistics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./review.html"> 
<span class="menu-text">Basic Review</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./confidence_intervals.html"> 
<span class="menu-text">Confidence Intervals</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./statistical_hypotheses.html"> 
<span class="menu-text">Statistical Hypotheses</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./linear_regression.html"> 
<span class="menu-text">Linear Regression</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./diagnostics.html"> 
<span class="menu-text">Diagnostics</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./anova_categorical.html"> 
<span class="menu-text">ANOVA for Categorical</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./model_selection.html" aria-current="page"> 
<span class="menu-text">Model Selection</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./bayes_nets.html"> 
<span class="menu-text">Bayesian Networks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./glm.html"> 
<span class="menu-text">Generalized Linear Models</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./gam.html"> 
<span class="menu-text">Generalized Additive Models</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">
<li>
    <a class="dropdown-item" href="https://github.com/clickityKlein/Statistics">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/clickityKlein">
 <span class="dropdown-text">Carl Klein’s Main Page</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#methods" id="toc-methods" class="nav-link active" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
<li><a href="#aic" id="toc-aic" class="nav-link" data-scroll-target="#aic">AIC</a></li>
  <li><a href="#bic" id="toc-bic" class="nav-link" data-scroll-target="#bic">BIC</a></li>
  <li><a href="#mean-squared-prediction-error" id="toc-mean-squared-prediction-error" class="nav-link" data-scroll-target="#mean-squared-prediction-error">Mean Squared Prediction Error</a></li>
  <li><a href="#goals-and-motivation" id="toc-goals-and-motivation" class="nav-link" data-scroll-target="#goals-and-motivation">Goals and Motivation</a></li>
  <li><a href="#procedure-for-using-the-methods" id="toc-procedure-for-using-the-methods" class="nav-link" data-scroll-target="#procedure-for-using-the-methods">Procedure for Using the Methods</a></li>
  </ul>
</li>
  <li><a href="#post-hoc-consideration-multicollinearity" id="toc-post-hoc-consideration-multicollinearity" class="nav-link" data-scroll-target="#post-hoc-consideration-multicollinearity">Post-hoc Consideration: Multicollinearity</a></li>
  <li>
<a href="#implementing" id="toc-implementing" class="nav-link" data-scroll-target="#implementing">Implementing</a>
  <ul class="collapse">
<li>
<a href="#stepwise-methods-update-and-regsubsets" id="toc-stepwise-methods-update-and-regsubsets" class="nav-link" data-scroll-target="#stepwise-methods-update-and-regsubsets">Stepwise Methods (UPDATE and REGSUBSETS)</a>
  <ul class="collapse">
<li><a href="#update" id="toc-update" class="nav-link" data-scroll-target="#update">Update</a></li>
  <li><a href="#regsubsets" id="toc-regsubsets" class="nav-link" data-scroll-target="#regsubsets">Regsubsets</a></li>
  </ul>
</li>
  <li><a href="#custom-function" id="toc-custom-function" class="nav-link" data-scroll-target="#custom-function">Custom Function</a></li>
  <li><a href="#variance-inflation-factors-vif" id="toc-variance-inflation-factors-vif" class="nav-link" data-scroll-target="#variance-inflation-factors-vif">Variance Inflation Factors (VIF)</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Model Selection</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>F-tests and t-tests are decent for simple models. We know that <span class="math inline">\(R^2\)</span> holds significance for simple linear regression, and that <span class="math inline">\(R_a^2\)</span> holds significance for multiple linear regression. We can use these tests and metrics to compare different features in models across datasets. But, how do we use this for more complicated models? What about the case for a model with many predictors? If we were test different models manually for a dataset with 100 features, that’s <span class="math inline">\(2^{100}\)</span> combinations!</p>
<section id="methods" class="level1"><h1>Methods</h1>
<ul>
<li>Hypothesis Testings Based Methods
<ul>
<li>backwards elimination:
<ul>
<li>start with the full model, successively remove the predictor with the largest p-value greater than a selected threshold until either all p-values are below the selected threshold, or until a minimum number of features threshold is met</li>
</ul>
</li>
<li>forward selection:
<ul>
<li>start with all possible simple (single feature) linear models, select the best model (i.e.&nbsp;lowest p-value), test all remaining features, select the best model for two features, and then successively repeat until either nothing else adds to the model, or until a maximum number of features threshold is met</li>
</ul>
</li>
<li>stepwise regression (bi-directional):
<ul>
<li>essentially uses forwards and backwards elimination simultaneously, i.e.&nbsp;at each stage allow for any variable to be added or removed</li>
</ul>
</li>
</ul>
</li>
<li>Criteria Based Methods:
<ul>
<li>AIC (Akaike Information Criteria)</li>
<li>BIC (Bayes Information Criteria)</li>
<li>MSPE (mean-squared prediction error)</li>
<li>
<span class="math inline">\(R^2_a\)</span> (Adjusted R-Squared)</li>
</ul>
</li>
</ul>
<blockquote class="blockquote">
<p>We actually normally use the criteria based methods (metrics) to help determine the “best” model, as we’ll show later on in this page.</p>
</blockquote>
<section id="aic" class="level2"><h2 class="anchored" data-anchor-id="aic">AIC</h2>
<p><span class="math display">\[AIC = 2(p+1) - 2\log(\frac{SSE}{n})\]</span></p>
<p><span class="math inline">\(AIC\)</span> estimates the relative amount of information that is lost by a given model in effort to minimize the information that’s lost.</p>
<p>The first term is an estimate of complexity with respect to the model, while the second term is an estimate of model fit. <em>Normally</em> thought of as a decent metric for prediction goals, though this is not a “hard and fast” rule.</p>
</section><section id="bic" class="level2"><h2 class="anchored" data-anchor-id="bic">BIC</h2>
<p><span class="math display">\[BIC = (p+1)log(n) - 2logL(\hat{\beta})\]</span></p>
<p><span class="math inline">\(BIC\)</span> is similar estimate to <span class="math inline">\(AIC\)</span> with slightly different parameters, where</p>
<ul>
<li>
<span class="math inline">\(logL(\hat{\beta})\)</span> is the log likelihood function</li>
</ul>
<p>BIC is <em>normally</em> thought of as a decent metric for explanation goals, though this is not a “hard and fast” rule. For a very large amount of features, the penalty term for BIC is larger than AIC.</p>
</section><section id="mean-squared-prediction-error" class="level2"><h2 class="anchored" data-anchor-id="mean-squared-prediction-error">Mean Squared Prediction Error</h2>
<p><span class="math display">\[MSPE = \frac{1}{n}\sum^n_{i=1} (y_i - \hat{y_i})^2\]</span></p>
<p><span class="math inline">\(MSPE\)</span> quantifies the discrepancy between the predicted values and the observed value, and can help to evalute the performance of a model.</p>
</section><section id="goals-and-motivation" class="level2"><h2 class="anchored" data-anchor-id="goals-and-motivation">Goals and Motivation</h2>
<p>Our goal is to ultimately select a model <span class="math inline">\(g\)</span> (parameterized by <span class="math inline">\(\beta\)</span>) that is <em>close</em> to the <em>true</em> model <span class="math inline">\(f\)</span>.</p>
<p><strong>Kullback-Leiber</strong> distance:</p>
<p><span class="math inline">\(D_{KL}(f, g) = \int f(x) log(\frac{f(x)}{g(x; \beta)}) dx\)</span></p>
<p><span class="math inline">\(= \int f(x) log(f(x))dx - \int f(x) log(g(x; \beta))dx\)</span></p>
<p>The first term is constant with respect to <span class="math inline">\(g\)</span>, and it can be shown the second term can be estimated to <span class="math inline">\(-log(L(\hat{\beta})) + (p+1) + c\)</span> (i.e.&nbsp;model complexity + model fit)</p>
<p><span class="math inline">\(\rightarrow AIC(g(x; \hat{\beta}))\)</span></p>
<p><span class="math inline">\(\rightarrow BIC(g(x; \hat{\beta}))\)</span></p>
</section><section id="procedure-for-using-the-methods" class="level2"><h2 class="anchored" data-anchor-id="procedure-for-using-the-methods">Procedure for Using the Methods</h2>
<blockquote class="blockquote">
<p>MSPE requires testing and training split datasets, while it is just a recommendation for AIC, BIC, and <span class="math inline">\(R^2_a\)</span></p>
</blockquote>
<ol type="1">
<li><em>Split data into training/test sets</em></li>
<li>Fit several competing models (training set)</li>
</ol>
<ul>
<li>Can use backwards, forwards, or bi-directional algorithms to help pick the models to test (more on this later)</li>
</ul>
<ol start="3" type="1">
<li>Calculate metric(s)</li>
<li>Choose the optimal model</li>
</ol>
<ul>
<li>Minimize <span class="math inline">\(AIC\)</span>
</li>
<li>Minimize <span class="math inline">\(BIC\)</span>
</li>
<li>Minimize <span class="math inline">\(MSPE\)</span>
</li>
<li>Maximize <span class="math inline">\(R^2_a\)</span>
</li>
</ul></section></section><section id="post-hoc-consideration-multicollinearity" class="level1"><h1>Post-hoc Consideration: Multicollinearity</h1>
<p>Recall the issue with multicollinearity, which is when there is linear dependence between columns of data. This is a concern because lienar dependence causes non-invertibility in the matrices <span class="math inline">\(X^TX\)</span> and <span class="math inline">\(XX^T\)</span> for any given matrix <span class="math inline">\(X\)</span>. This is disruptive in creating MLR models.</p>
<p>We can test for multicollinearity through correlation matrices, or Variance Inflation Factors (VIF). In particular, VIF for the <span class="math inline">\(j^{th}\)</span> predictor is <span class="math inline">\(VIF_j = \frac{1}{1 - R^2_j}\)</span>. This is <span class="math inline">\(R^2\)</span> value associated with regressing the <span class="math inline">\(j^{th}\)</span> predictor on the remaining predictors. Anything over a VIF of 5 is generally considered indicative of multicollinearity.</p>
</section><section id="implementing" class="level1"><h1>Implementing</h1>
<blockquote class="blockquote">
<p>Import Libraries and Data</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'caret' was built under R version 4.3.2</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'corrplot' was built under R version 4.3.3</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'reshape2' was built under R version 4.3.2</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">leaps</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'leaps' was built under R version 4.3.3</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://rpkgs.datanovia.com/ggpubr/">'ggpubr'</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggpubr' was built under R version 4.3.3</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'car' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'carData' was built under R version 4.3.3</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">'data/baseball.csv'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Rows: 1232 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (7): OBP, SLG, BA, WP, RD, Playoffs, Champion

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
    OBP   SLG    BA    WP    RD Playoffs Champion
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 0.328 0.418 0.259 0.5      46        0        0
2 0.32  0.389 0.247 0.580   100        1        0
3 0.311 0.417 0.247 0.574     7        1        0
4 0.315 0.415 0.26  0.426   -72        0        0
5 0.302 0.378 0.24  0.377  -146        0        0
6 0.318 0.422 0.255 0.525    72        0        0</code></pre>
</div>
</div>
<section id="stepwise-methods-update-and-regsubsets" class="level2"><h2 class="anchored" data-anchor-id="stepwise-methods-update-and-regsubsets">Stepwise Methods (UPDATE and REGSUBSETS)</h2>
<p>We can systematically implement functions for <strong>forwards</strong> and <strong>backwards</strong> selection using <code><a href="https://rdrr.io/r/stats/update.html">update()</a></code>, but one method that can be directly implemented in R is through <code><a href="https://rdrr.io/pkg/leaps/man/regsubsets.html">regsubsets()</a></code>.</p>
<section id="update" class="level3"><h3 class="anchored" data-anchor-id="update">Update</h3>
<blockquote class="blockquote">
<p>Create SLR, Update To Add Variable, Update to Remove Variable</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create model to predict WP from OBP</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>, <span class="va">WP</span><span class="op">~</span><span class="va">OBP</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WP ~ OBP, data = df)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.232282 -0.044727  0.001874  0.044186  0.185660 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.24102    0.03837  -6.282 4.64e-10 ***
OBP          2.26964    0.11745  19.324  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06187 on 1230 degrees of freedom
Multiple R-squared:  0.2329,    Adjusted R-squared:  0.2323 
F-statistic: 373.4 on 1 and 1230 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># update model to add SLG</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">SLG</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WP ~ OBP + SLG, data = df)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.229835 -0.044301  0.001687  0.044303  0.181604 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.22136    0.04123  -5.369 9.46e-08 ***
OBP          2.07235    0.19188  10.800  &lt; 2e-16 ***
SLG          0.11257    0.08659   1.300    0.194    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06185 on 1229 degrees of freedom
Multiple R-squared:  0.2339,    Adjusted R-squared:  0.2327 
F-statistic: 187.7 on 2 and 1229 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># update model to remove OBP</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">OBP</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WP ~ SLG, data = df)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.220219 -0.045113  0.002577  0.046060  0.175795 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.16101    0.02210   7.286 5.71e-13 ***
SLG          0.85224    0.05542  15.377  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06469 on 1230 degrees of freedom
Multiple R-squared:  0.1612,    Adjusted R-squared:  0.1606 
F-statistic: 236.4 on 1 and 1230 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section><section id="regsubsets" class="level3"><h3 class="anchored" data-anchor-id="regsubsets">Regsubsets</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reg_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaps/man/regsubsets.html">regsubsets</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>, <span class="va">WP</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reg_lm</span><span class="op">)</span></span>
<span><span class="va">rs</span><span class="op">$</span><span class="va">which</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)   OBP   SLG    BA   RD Playoffs Champion
1        TRUE FALSE FALSE FALSE TRUE    FALSE    FALSE
2        TRUE FALSE FALSE FALSE TRUE     TRUE    FALSE
3        TRUE FALSE FALSE FALSE TRUE     TRUE     TRUE
4        TRUE FALSE FALSE  TRUE TRUE     TRUE     TRUE
5        TRUE  TRUE FALSE  TRUE TRUE     TRUE     TRUE
6        TRUE  TRUE  TRUE  TRUE TRUE     TRUE     TRUE</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Each row represents a progressive combination of features, representing the best model of different sizes, with each row adding a new feature. The best models are determined by lowest SSE, or sum squared error.</p>
</blockquote>
</section></section><section id="custom-function" class="level2"><h2 class="anchored" data-anchor-id="custom-function">Custom Function</h2>
<blockquote class="blockquote">
<p>Custom Function for MSPE</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function for returning mspe form a regsubset output</span></span>
<span><span class="va">mspe_loop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">train_set</span>, <span class="va">test_set</span>, <span class="va">regsubset_summary</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># observed values from test set</span></span>
<span>    <span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">test_set</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="co"># initialize mspe tracking list</span></span>
<span>    <span class="va">mspe_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">loop_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">regsubset_summary</span><span class="op">$</span><span class="va">which</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">model</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">loop_size</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># create model</span></span>
<span>        <span class="va">true_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">regsubset_summary</span><span class="op">$</span><span class="va">which</span><span class="op">[</span><span class="va">model</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># remove intercept feature</span></span>
<span>        <span class="va">true_cols</span> <span class="op">&lt;-</span> <span class="va">true_cols</span><span class="op">[</span><span class="va">true_cols</span> <span class="op">!=</span> <span class="st">'(Intercept)'</span><span class="op">]</span></span>
<span>        <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">true_cols</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">'+'</span><span class="op">)</span></span>
<span>        <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'~'</span>, <span class="va">formula</span>, <span class="st">''</span><span class="op">)</span></span>
<span>        <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">response</span>, <span class="va">formula</span>, <span class="st">''</span><span class="op">)</span></span>
<span>        <span class="va">lmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">train_set</span>, <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># calculate MSPE</span></span>
<span>        <span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">lmod</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">test_set</span><span class="op">)</span></span>
<span>        <span class="va">mspe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">obs</span> <span class="op">-</span> <span class="va">preds</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>        <span class="va">mspe_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mspe_results</span>, <span class="va">mspe</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mspe_results</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Custom Function for Creating a Long Dataframe</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># function for making dataframe long with respect to response variable</span></span>
<span><span class="va">create_long_df</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>                            cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            names_to <span class="op">=</span> <span class="st">'feature_names'</span>,</span>
<span>                            values_to <span class="op">=</span> <span class="st">'feature_values'</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df_long</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Custom Function for Plotting Facets from a Long Dataframe</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create function for faceted plots</span></span>
<span><span class="va">plot_long_facets</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_long</span>, <span class="va">subset_type</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">title_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">subset_type</span>, <span class="va">response</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_long</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">feature_values</span>, y<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rlang.r-lib.org/reference/sym.html">sym</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">feature_names</span>, scales <span class="op">=</span> <span class="st">'free_x'</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="va">title_text</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'Feature'</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Function for Full Model MLR Plotting</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create function mlr the plotting</span></span>
<span><span class="va">plot_mlr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">full_set</span>, <span class="va">train_set</span>, <span class="va">test_set</span>, <span class="va">response</span>, <span class="va">subset_type</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># faceted plots</span></span>
<span>    <span class="co"># 1) build long dataframe with respect to variabe</span></span>
<span>    <span class="co"># 2) create plots</span></span>
<span>    <span class="va">df_long</span> <span class="op">&lt;-</span> <span class="fu">create_long_df</span><span class="op">(</span>df<span class="op">=</span><span class="va">full_set</span>, response<span class="op">=</span><span class="va">response</span><span class="op">)</span></span>
<span>    <span class="va">faceted_plots</span> <span class="op">&lt;-</span> <span class="fu">plot_long_facets</span><span class="op">(</span>df_long<span class="op">=</span><span class="va">df_long</span>,</span>
<span>                                      subset_type<span class="op">=</span><span class="va">subset_type</span>,</span>
<span>                                      response<span class="op">=</span><span class="va">response</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">faceted_plots</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># regsubsets builds models with forward selection</span></span>
<span>    <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">response</span>, <span class="st">'~.'</span>, <span class="st">''</span><span class="op">)</span></span>
<span>    <span class="va">reg_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaps/man/regsubsets.html">regsubsets</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">train_set</span>, <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reg_lm</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rs</span><span class="op">$</span><span class="va">which</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># compute dimensions from dataset</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">train_set</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">train_set</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">m</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># compute metrics</span></span>
<span>    <span class="va">AIC</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">+</span> <span class="va">n</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rs</span><span class="op">$</span><span class="va">rss</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">BIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="va">m</span><span class="op">)</span> <span class="op">+</span> <span class="va">n</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">rs</span><span class="op">$</span><span class="va">rss</span><span class="op">/</span><span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">R2Adj</span> <span class="op">&lt;-</span> <span class="va">rs</span><span class="op">$</span><span class="va">adjr2</span></span>
<span>    <span class="va">mspe</span> <span class="op">&lt;-</span> <span class="fu">mspe_loop</span><span class="op">(</span>train_set<span class="op">=</span><span class="va">train_set</span>,</span>
<span>                      test_set<span class="op">=</span><span class="va">test_set</span>,</span>
<span>                      regsubset_summary<span class="op">=</span><span class="va">rs</span>,</span>
<span>                      response<span class="op">=</span><span class="va">response</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># turn metrics into dataframes</span></span>
<span>    <span class="va">AIC_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>AIC <span class="op">=</span> <span class="va">AIC</span><span class="op">)</span></span>
<span>    <span class="va">BIC_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>BIC <span class="op">=</span> <span class="va">BIC</span><span class="op">)</span></span>
<span>    <span class="va">R2Adj_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>R2Adj <span class="op">=</span> <span class="va">R2Adj</span><span class="op">)</span></span>
<span>    <span class="va">mspe_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>MSPE <span class="op">=</span> <span class="va">mspe</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># AIC Plot</span></span>
<span>    <span class="va">AIC_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">AIC_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">AIC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">AIC</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">AIC</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'Model'</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># BIC Plot</span></span>
<span>    <span class="va">BIC_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">BIC_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">BIC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">BIC</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">BIC</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'Model'</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Adjusted R2 Plot</span></span>
<span>    <span class="va">R2Adj_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">R2Adj_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">R2Adj</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">R2Adj</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">R2Adj</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'Model'</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># MSPE Plot</span></span>
<span>    <span class="va">MSPE_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mspe_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">MSPE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">mspe</span><span class="op">)</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">mspe</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'Model'</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># combine plots</span></span>
<span>    <span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">AIC_plot</span>, <span class="va">BIC_plot</span>, <span class="va">R2Adj_plot</span>, <span class="va">MSPE_plot</span>,</span>
<span>                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'AIC'</span>, <span class="st">'BIC'</span>, <span class="st">'R2Adj'</span>, <span class="st">'MSPE'</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">combined_plot</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Create test/train set and Run Custom Model Plotting</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="co">#find the number corresponding to 80% of the data</span></span>
<span><span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="co">#randomly sample indicies to be included in the training set</span></span>
<span><span class="co"># playoffs</span></span>
<span><span class="va">train</span> <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span>, <span class="op">]</span> <span class="co">#set the training set to be the randomly sampled rows of the dataframe</span></span>
<span><span class="va">test</span> <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="va">index</span>, <span class="op">]</span> <span class="co">#set the testing set to be the remaining rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">plot_mlr</span><span class="op">(</span>full_set<span class="op">=</span><span class="va">df</span>,</span>
<span>         train_set<span class="op">=</span><span class="va">train</span>,</span>
<span>         test_set<span class="op">=</span><span class="va">test</span>,</span>
<span>         response<span class="op">=</span><span class="st">'WP'</span>,</span>
<span>         subset_type<span class="op">=</span><span class="st">''</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="model_selection_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)   OBP   SLG    BA   RD Playoffs Champion
1        TRUE FALSE FALSE FALSE TRUE    FALSE    FALSE
2        TRUE FALSE FALSE FALSE TRUE     TRUE    FALSE
3        TRUE FALSE FALSE FALSE TRUE     TRUE     TRUE
4        TRUE FALSE FALSE  TRUE TRUE     TRUE     TRUE
5        TRUE  TRUE FALSE  TRUE TRUE     TRUE     TRUE
6        TRUE  TRUE  TRUE  TRUE TRUE     TRUE     TRUE</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="model_selection_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>We can build a final model using the fact that both AIC and MSPE suggest Model 3.</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">final_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">df</span>, <span class="va">WP</span> <span class="op">~</span> <span class="va">RD</span> <span class="op">+</span> <span class="va">Playoffs</span> <span class="op">+</span> <span class="va">Champion</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">final_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = WP ~ RD + Playoffs + Champion, data = df)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.088497 -0.016262  0.000326  0.015971  0.075166 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4.957e-01  7.905e-04 627.027  &lt; 2e-16 ***
RD          5.972e-04  8.156e-06  73.220  &lt; 2e-16 ***
Playoffs    1.790e-02  2.166e-03   8.263 3.63e-16 ***
Champion    9.523e-03  3.742e-03   2.545   0.0111 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.02366 on 1228 degrees of freedom
Multiple R-squared:  0.888, Adjusted R-squared:  0.8877 
F-statistic:  3246 on 3 and 1228 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section><section id="variance-inflation-factors-vif" class="level2"><h2 class="anchored" data-anchor-id="variance-inflation-factors-vif">Variance Inflation Factors (VIF)</h2>
<blockquote class="blockquote">
<p>Finally, we can test the model for any multicollinearity.</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html">vif</a></span><span class="op">(</span><span class="va">final_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      RD Playoffs Champion 
1.545945 1.640246 1.246315 </code></pre>
</div>
</div>
<p><strong>Note that all features have a VIF under 5, thus our model does lack evidence suggesting any multicollinearity.</strong></p>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><a href="https://clickityklein.github.io/Carl-Klein/">About Carl Klein</a></p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>